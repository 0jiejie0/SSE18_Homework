#include <avr/pgmspace.h>
//引入库函数，将部分数组写入rom减少内存占用
//设置接口
#define buzzpin 4
#define lepin 2
// 传邮万里  完整版  added by xianfei wang

const short chuanyouwanli1[] PROGMEM =        
{//qianzou
  350,393,
  441,441,294,350,393,
  441,294,294,
  495,294,495,556,294,
  441,393,350,
  330,221,330,350,
  //row2
  294,221,
  350,350,350,350,393,441,
  330,221,
  330,330,330,330,350,393,
  350,294,
  495,495,495,495,556,589,
  //row3
  441,393,350,248,
  393,393,393,393,441,495,
  441,330,221,
  350,350,350,350,393,441,
  330,221,
  330,330,330,330,350,393,
  //row4
  350,294,
  495,495,495,495,556,589,
  441,393,350,248,
  330,330,330,60000,350,330,294,
  248,294,294,
  248,294,495,
  //row5
  441,393,350,
  330,330,294,330,
  350,294,
  495,556,589,
  441,294,294,
  495,495,556,589,
  //row6-beiyouabeiyou
  661,350,393,
  441,441,294,350,393,
  441,294,294,
  495,495,495,556,589,
  441,495,556,
  589,589,589,556,441,
  //row 7
  495,393,441,
  495,495,441,393,441,
  330,350,393,
  441,441,589,350,393,
  441,294,294,
  495,495,495,556,589,
  //row 8
  441,495,556,
  589,589,589,556,441,
  495,393,441,
  495,
  556,556,495,556,
  294,60000,
  //repeat
  221,
  350,350,350,350,393,441,
  330,221,
  330,330,330,330,350,393,
  350,294,
  495,495,495,495,556,589,
  //row3
  441,393,350,248,
  393,393,393,393,441,495,
  441,330,221,
  350,350,350,350,393,441,
  330,221,
  330,330,330,330,350,393,
  //row4
  350,294,
  495,495,495,495,556,589,
  441,393,350,248,
  330,330,330,60000,350,330,294,
  //houdeboxue
  248,294,294,
  248,294,495,
  //row5
  441,393,350,
  330,330,294,330,
  350,294,
  495,556,589,
  441,294,294,
  495,495,556,589,
  //row6-beiyouabeiyou
  661,350,393,
  441,441,294,350,393,
  441,294,294,
  495,495,495,556,589,
  441,495,556,
  589,589,589,556,441,
  //row 7
  495,393,441,
  495,495,441,393,441,
  330,350,393,
  441,441,589,350,393,
  441,294,294,
  495,495,495,556,589,
  //row 9
  441,393,441,
  495,495,294,393,441,
  495,495,556,
  589,589,589,556,441,
  495,393,441,
  495,
  556,556,495,556,
  294,
};

const short chuanyouwanli2[] PROGMEM =       
{//qianzou
  75,25,
  200,50,50,75,25,
  300,50,50,
  150,50,100,75,25,
  300,50,50,
  150,50,100,100,
  //row2
  300,100,
  150,50,75,25,75,25,
  300,100,
  150,50,75,25,75,25,
  300,100,
  150,50,100,33,33,33,
  //row3
  100,100,150,50,
  150,50,100,33,33,33,
  100,200,100,
  150,50,75,25,75,25,
  300,100,
  150,50,75,25,75,25,
  //row4
  300,100,
  150,50,100,33,33,33,
  100,100,150,50,
  150,50,50,50,33,33,33,
  100,200,100,
  300,75,25,
  //row5
  300,50,50,
  150,50,100,100,
  300,100,
  300,75,25,
  300,50,50,
  150,50,100,100,
  //row6
  300,75,25,
  200,50,50,75,25,
  300,50,50,
  200,50,50,50,50,
  300,50,50,
  50,200,50,50,50,
  //row7
  300,50,50,
  200,50,50,50,50,
  300,75,25,
  200,50,50,50,50,
  300,50,50,
  200,50,50,50,50,
  //row8
  300,50,50,
  50,200,50,50,50,
  300,50,50,
  400,
  100,100,150,50,
  300,100,
  //repeat
  //row2
  100,
  150,50,75,25,75,25,
  300,100,
  150,50,75,25,75,25,
  300,100,
  150,50,100,33,33,33,
  //row3
  100,100,150,50,
  150,50,100,33,33,33,
  100,200,100,
  150,50,75,25,75,25,
  300,100,
  150,50,75,25,75,25,
  //row4
  300,100,
  150,50,100,33,33,33,
  100,100,150,50,
  150,50,50,50,33,33,33,
  100,200,100,
  300,75,25,
  //row5
  300,50,50,
  150,50,100,100,
  300,100,
  300,75,25,
  300,50,50,
  150,50,100,100,
  //row6
  300,75,25,
  200,50,50,75,25,
  300,50,50,
  200,50,50,50,50,
  300,50,50,
  50,200,50,50,50,
  //row7
  300,50,50,
  200,50,50,50,50,
  300,75,25,
  200,50,50,50,50,
  300,50,50,
  200,50,50,50,50,
  //row9
  300,75,25,
  200,50,50,75,25,
  300,50,50,
  50,200,50,50,50,
  300,50,50,
  400,
  100,100,150,50,
  300,100
};

const short Eulogyofjoytune[] PROGMEM =         
{
  350,350,393,441,
  441,393,350,330,
  294,294,330,350,
  350,330,330,
  350,350,393,441,
  441,393,350,330,
  294,294,330,350,
  330,294,294,
  330,330,350,294,
  330,350,393,350,294,
  330,350,393,350,330,
  294,330,221,-1,
  350,350,393,441,
  441,393,350,393,330,
  294,294,330,350,
  330,294,294
};
const short lstune[] PROGMEM ={
  262,262,393,393,
  441,441,393,
  350,350,330,330,
  294,294,262,
  393,393,350,350,
  330,330,294,
  393,393,350,350,
  330,330,294,
  262,262,393,393,
  441,441,393,
  350,350,330,330,
  294,294,262
};

const short Eulogyofjoybeat[] PROGMEM =
{
  10,10,10,10,
  10,10,10,10,
  10,10,10,10,
  15,5,20,
  10,10,10,10,
  10,10,10,10,
  10,10,10,10,
  15,5,20,
  10,10,10,10,
  10,5,5,10,10,
  10,5,5,10,10,
  10,10,10,10,
  10,10,10,10,
  10,10,10,5,5,
  10,10,10,10,
  15,5,20
};
const short lsbeat[] PROGMEM ={
  1,1,1,1,
  1,1,2,
  1,1,1,1,
  1,1,2,
  1,1,1,1,
  1,1,2,
  1,1,1,1,
  1,1,2,
  1,1,1,1,
  1,1,2,
  1,1,1,1,
  1,1,2
};

short tune[] = 
{
  -1,-1,-1,556,661,
  742,-1,-1,661,742,-1,-1,661,
  742,882,661,742,556,-1,556,661,
  742,-1,-1,661,742,-1,-1,661,
  742,1112,882,990,742,-1,556,661,
  742,-1,-1,661,742,-1,-1,661,
  742,882,661,742,556,661,441,495,
  556,882,742,1112,
  990,1112,990,882,990,742,-1,
  742,742,742,742,882,990,1112,
  742,742,742,661,661,742,
  742,742,742,742,882,990,1112,
  742,742,742,1178,1178,1112,
  742,742,742,742,882,990,1112,
  742,742,742,661,661,742,
  742,742,742,742,882,990,1112,
  1484,661,661,742,742
};

float duration[]=
{
  1,1,1,0.5,0.5,
  0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
  0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
  0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
  0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
  0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
  0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
  1,1,1,1,
  0.5,0.25,0.25,0.5,0.5,1,1,
  1,1,1,0.25,0.25,0.25,0.25,
  1,1,0.5,0.5,0.5,0.5,
  1,1,1,0.25,0.25,0.25,0.25,
  1,1,0.5,0.5,0.5,0.5,
  1,1,1,0.25,0.25,0.25,0.25,
  1,1,0.5,0.5,0.5,0.5,
  1,1,1,0.25,0.25,0.25,0.25,
  1+0.5,0.5,0.5,0.5,1
};



void setup() {
  pinMode(buzzpin,OUTPUT);
  pinMode(lepin,OUTPUT);
  Serial.begin(9600);
  Serial.println("  ╔════════════════════════════════════╗");
  Serial.println("  ║   这是一个简单的点歌程序  by  王衔飞   ║");
  Serial.println("  ║                                    ║");
  Serial.println("  ║   请输入想听的歌曲的序号:             ║");
  Serial.println("  ║     1、 《传邮万里》                 ║");
  Serial.println("  ║     2、 《小星星》  　               ║");
  Serial.println("  ║     3、 《欢乐颂》  　               ║");  
  Serial.println("  ║     4、 《极乐净土》                 ║");
  Serial.println("  ║                                    ║");
  Serial.println("  ╚════════════════════════════════════╝");
  //Serial.println("test");
}
//播放歌曲的函数
//传邮万里
void start1(){
  for(int x=0;x<350;x++)
  {
    tone(buzzpin,pgm_read_word(&chuanyouwanli1[x]));
    digitalWrite(lepin, HIGH); 
    delay(3.2*pgm_read_word(&chuanyouwanli2[x]));
    digitalWrite(lepin, LOW);
    noTone(buzzpin);   
    delay(100);
  }
}
//极乐净土
void start(int len,short *tune,float *beat){
  
  for(int x=0;x<len;x++)
  {
    tone(buzzpin,tune[x]);
    digitalWrite(lepin, HIGH); 
    delay(450*beat[x]);
    digitalWrite(lepin, LOW);
    noTone(buzzpin);   
    delay(100);
  }
}
//小星星
void startxxx(){
  for(int x=0;x<42;x++)
  {
    tone(buzzpin,pgm_read_word(&lstune[x]));
    digitalWrite(lepin, HIGH); 
    delay(500*pgm_read_word(&lsbeat[x]));
    digitalWrite(lepin, LOW);
    noTone(buzzpin);   
    delay(100);
  }
}
//欢乐颂
void starthls(){
  for(int x=0;x<64;x++)
  {
    tone(buzzpin,pgm_read_word(&Eulogyofjoytune[x]));
    digitalWrite(lepin, HIGH); 
    delay(50*pgm_read_word(&Eulogyofjoybeat[x]));//与前一代码不同之处，这里将原来的500分为了400和100，分别控制led的开与关，对于蜂鸣器来说依然是500.
    digitalWrite(lepin, LOW);
    noTone(buzzpin);   
    delay(100);
  }
}

void loop() {

  String select;
  while(Serial.available()>0){
    select+=char(Serial.read());
    delay(2);
  }
  if(select!=""){
    int len;
    if(select=="3"){
      Serial.println("好的，那我们开始播放《欢乐颂》");
      Serial.println("如需重新点歌请按下主板上的reset按钮");
      starthls();
    }else if(select=="2"){
            Serial.println("好的，那我们开始播放《小星星》");
            Serial.println("如需重新点歌请按下主板上的reset按钮");
      startxxx();
    }else if(select=="4"){
            Serial.println("好的，那我们开始播放《极乐净土》");
            Serial.println("如需重新点歌请按下主板上的reset按钮");
      len=sizeof(tune)/sizeof(tune[0]);
      start(len,tune,duration);
    }else if(select=="1"){
      Serial.println("好的，那我们开始播放《传邮万里》");
      Serial.println("如需重新点歌请按下主板上的reset按钮");
      start1();
    }else{
      Serial.println("请重新输入代号");
    }
  }
  
}
